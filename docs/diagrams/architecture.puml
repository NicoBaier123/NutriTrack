@startuml
skinparam monochrome true
skinparam defaultFontName Courier
skinparam defaultFontSize 12
skinparam linetype ortho
left to right direction

rectangle "Frontend / Client" as FE
rectangle "FastAPI Backend" as API
rectangle "RAG Controller" as RAG

rectangle "Retrieval Layer" {
  rectangle "Retriever\n(Vector index + metadata)" as RET
  rectangle "Cache: Foods\n(Naehrwerte per ingredient)" as CACHE
  rectangle "SQLite: dbwdi.db" as DB
  rectangle "Recipes + Ingredients\n(Own schema)" as REC
}

rectangle "Generation Layer" {
  rectangle "Llama Model\n(Generation)" as LLM
  rectangle "Ingredient Analysis\n(Tokenization / NER)" as ZUT
  rectangle "Portioning Logic\n(Target & daily balance)" as PORT
}

rectangle "External APIs" {
  rectangle "FDC / OFF API\n(Naehrwert sources)" as FDC
}

FE <-> API
API -right-> RAG
RAG -right-> RET
RAG -right-> LLM
RET -down-> CACHE
CACHE -down-> DB
RET -down-> REC
LLM -down-> ZUT
ZUT -down-> PORT
RET -right-> ZUT
REC -right-> PORT
CACHE -right-> PORT
ZUT -right-> FDC
FDC -left-> CACHE
PORT -left-> API

@enduml