RAG System Testing Log - Started at 2025-11-04 23:06:46
2025-11-04 23:06:50
=== Task 1: Environment Check ===
Python 3.13.2
Python 3.13.2
--- Checking SQLite Installation ---
SQLite found at C:\sqlite\sqlite3.exe
3.51.0 2025-11-04 19:38:17 fb2c931ae597f8d00a37574ff67aeed3eced4e5547f9120744a-experimental (64-bit)
--- Testing SQLite PATH Access ---
ERROR: sqlite3 command not in PATH. Using full path: C:\sqlite\sqlite3.exe
--- Checking Database File ---
Database file found: dbwdi.db
208896
--- Task 2: Database Query Test ---
2025-11-04 23:07:49
60
Error: in prepare, no such table: recipe_embeddings
wearable_daily
food
meal
foodpending
mealitem
foodsynonym
foodsource
recipe
recipeingredient
recipeitem
60
SUCCESS: Found 60 recipes in database
NOTE: recipe_embeddings table does not exist yet (will be created on first RAG run)
--- Task 3: Testing Embedding Service Start ---
2025-11-04 23:08:29
sentence-transformers installed
Testing embedding service import...
Traceback (most recent call last):
  File "<string>", line 1, in <module>
    from backend.scripts.embed_service import app; print('SUCCESS: Embedding service module imported')
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
ModuleNotFoundError: No module named 'backend'
Starting embedding service in background (10 second test)...
SUCCESS: Embedding service started and responding
{"status":"ok"}
NOTE: Direct Python import failed (expected - uvicorn handles module loading)
SUCCESS: Embedding service started via uvicorn and is responding
Testing embedding endpoint...
SUCCESS: Embedding endpoint works. Vector dimensions: 384
--- Task 4: Testing Main API Server ---
2025-11-04 23:09:31
Starting main API server in background...
SUCCESS: Main API server started and responding
200
--- Task 5: Testing RAG Compose Endpoint ---
2025-11-04 23:09:51
SUCCESS: RAG compose endpoint responded
Number of ideas returned: 3
First idea source: rag
First idea title: Tropical Green Revive Bowl
--- Checking if embeddings were cached after RAG query ---
Error: in prepare, no such table: recipe_embeddings
--- Testing second RAG query with detailed response ---
Response saved to rag_response_detailed.json
C:\Users\usewr\dbwdi\backend\.venv\Lib\site-packages\ctranslate2\__init__.py:8: UserWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html. The pkg_resources package is slated for removal as early as 2025-11-30. Refrain from using this package or pin to Setuptools<81.
  import pkg_resources
=== RAG System State Check ===

Total recipes in database: 23
Traceback (most recent call last):
  File "C:\Users\usewr\dbwdi\backend\check_rag_state.py", line 27, in <module>
    print("\n\u2713 recipe_embeddings table exists")
    ~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python313\Lib\encodings\cp1252.py", line 19, in encode
    return codecs.charmap_encode(input,self.errors,encoding_table)[0]
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
UnicodeEncodeError: 'charmap' codec can't encode character '\u2713' in position 2: character maps to <undefined>
C:\Users\usewr\dbwdi\backend\.venv\Lib\site-packages\ctranslate2\__init__.py:8: UserWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html. The pkg_resources package is slated for removal as early as 2025-11-30. Refrain from using this package or pin to Setuptools<81.
  import pkg_resources
=== RAG System State Check ===

Total recipes in database: 23

[OK] recipe_embeddings table exists
  Cached embeddings: 23

Embedding cache status:
  1: Kichererbsen-Quinoa-Bowl                 - [CACHED]
  2: Hafer-Beeren-Fruehstueck                 - [CACHED]
  3: Linsen-Nudel-Salat                       - [CACHED]
  4: Sunrise Citrus Glow Bowl                 - [CACHED]
  5: Forest Berry Crunch Bowl                 - [CACHED]
  6: Tropical Green Revive Bowl               - [CACHED]
  7: Golden Immunity Bowl                     - [CACHED]
  8: Jackfruit Paradise Bowl                  - [CACHED]
  9: Cacao Almond Dream Bowl                  - [CACHED]
  10: Garden Greens Detox Bowl                 - [CACHED]
--- Task 6: Testing Embedding Caching (Second Query) ---
2025-11-04 23:12:00
2,1632586
Query completed (time logged above)
Background jobs cleaned up
--- Task 7: Running Automated Tests ---
2025-11-04 23:12:20
============================= test session starts =============================
platform win32 -- Python 3.13.2, pytest-8.4.2, pluggy-1.6.0
rootdir: C:\Users\usewr\dbwdi\backend
configfile: pytest.ini
plugins: anyio-4.11.0, asyncio-1.2.0, cov-7.0.0
asyncio: mode=Mode.AUTO, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collected 19 items

tests\integration\test_rag_modular.py ...................                [100%]

============================== warnings summary ===============================
.venv\Lib\site-packages\ctranslate2\__init__.py:8
  C:\Users\usewr\dbwdi\backend\.venv\Lib\site-packages\ctranslate2\__init__.py:8: UserWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html. The pkg_resources package is slated for removal as early as 2025-11-30. Refrain from using this package or pin to Setuptools<81.
    import pkg_resources

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=============================== tests coverage ================================
_______________ coverage: platform win32, python 3.13.2-final-0 _______________

Name                              Stmts   Miss  Cover   Missing
---------------------------------------------------------------
src\app\__init__.py                   2      0   100%
src\app\core\__init__.py              0      0   100%
src\app\core\config.py               21      0   100%
src\app\core\database.py             16      5    69%   14, 28-30, 34-35
src\app\db.py                         2      0   100%
src\app\main.py                      44     10    77%   46-49, 53, 74-75, 79, 83, 87
src\app\models\__init__.py            5      0   100%
src\app\models\foods.py               9      0   100%
src\app\models\foods_extra.py        20      0   100%
src\app\models\meals.py              24      0   100%
src\app\models\recipes.py            31      0   100%
src\app\models\wearables.py          30      0   100%
src\app\rag\__init__.py               4      0   100%
src\app\rag\indexer.py               93      9    90%   58, 61-62, 118, 157, 185-187, 225
src\app\rag\postprocess.py          102      7    93%   47, 67, 106, 110, 120, 138, 276
src\app\rag\preprocess.py            65      4    94%   30, 48, 91, 161
src\app\routers\__init__.py          10      0   100%
src\app\routers\advisor.py          996    833    16%   26-27, 35-36, 102, 124-169, 180-183, 189-210, 214-220, 229-248, 253-263, 266-269, 274-280, 283-284, 298-307, 311-333, 342-396, 407-471, 476-483, 493-542, 546-566, 581-582, 594, 598-605, 609-611, 615-635, 639-642, 646-656, 660-675, 679-696, 700-709, 713-724, 728-741, 761-898, 901-904, 921-966, 986-1141, 1164-1178, 1219-1233, 1237-1251, 1255-1258, 1271-1283, 1286-1292, 1295-1308, 1312-1335, 1339-1364, 1368-1488, 1494-1552, 1556-1738
src\app\routers\demo_ui.py            9      1    89%   14
src\app\routers\foods.py             27     10    63%   24-34, 38-41
src\app\routers\foods_lookup.py     204    149    27%   22-24, 27-33, 37-59, 62-82, 86-94, 98-110, 113-131, 171-221, 225-278, 283-284, 289-298
src\app\routers\health.py             5      1    80%   7
src\app\routers\ingest.py            67     49    27%   19-24, 41-108
src\app\routers\meals.py             95     69    27%   25-30, 42-66, 87-140, 152-192, 197-205, 218-223, 228-235
src\app\routers\meals_ingest.py     113     72    36%   49-50, 53-57, 60-102, 105-106, 111-162
src\app\routers\nlp.py              130     95    27%   45-54, 60-70, 74-79, 86-105, 118-155, 168-173, 188-235
src\app\routers\summary.py          131     80    39%   63-85, 98-101, 106-108, 120-136, 150-224, 254-267
src\app\routers\wearables.py         57     44    23%   20, 38-78, 93-113
src\app\utils\nutrition.py           30     17    43%   15, 35-44, 53-59, 63
---------------------------------------------------------------
TOTAL                              2342   1455    38%
======================== 19 passed, 1 warning in 1.77s ========================
SUCCESS: All 19 RAG modular tests passed
--- Task 8: Running RAG Evaluation Script ---
2025-11-04 23:12:46
  Retrieved Titles: Tropical Green Revive Bowl, Minted Melon Silk Bowl, Golden Berry Glow Bowl...
  Expected Titles:  Sunrise Citrus Glow Bowl, Tropical Green Revive Bowl, Radiant Roots Bowl

test_002:
  Retrieved: 5 recipes
  Expected:  2 recipes
  Hit Rate:  50.00%
  Precision@3: 33.33%
  Latency:   2.067s
  Retrieved Titles: Forest Berry Crunch Bowl, Guava Pine Oat Bowl, Peach Basil Bliss Bowl...
  Expected Titles:  Forest Berry Crunch Bowl, Sacha Super Seed Bowl

test_003:
  Retrieved: 5 recipes
  Expected:  3 recipes
  Hit Rate:  66.67%
  Precision@3: 66.67%
  Latency:   2.066s
  Retrieved Titles: Tropical Sunset Pitaya Bowl, Tropical Green Revive Bowl, Jackfruit Paradise Bowl...
  Expected Titles:  Tropical Sunset Pitaya Bowl, Tropical Green Revive Bowl, Sunrise Citrus Glow Bowl

test_004:
  Retrieved: 5 recipes
  Expected:  1 recipes
  Hit Rate:  0.00%
  Precision@3: 0.00%
  Latency:   2.079s
  Retrieved Titles: Tropical Green Revive Bowl, Radiant Roots Bowl, Minted Melon Silk Bowl...
  Expected Titles:  Forest Berry Crunch Bowl

test_005:
  Retrieved: 5 recipes
  Expected:  2 recipes
  Hit Rate:  0.00%
  Precision@3: 0.00%
  Latency:   2.075s
  Retrieved Titles: Tropical Green Revive Bowl, Autumn Harvest Bowl, Acai Boost Bowl...
  Expected Titles:  Mango Lucuma Crunch Bowl, Sacha Super Seed Bowl

[SUCCESS] Evaluation completed successfully.
Evaluation output saved to rag_eval_output.txt
--- Task 9: Final Summary ---
2025-11-04 23:13:23
=== TESTING SUMMARY ===

[OK] Environment: Python 3.13.2, Virtual env found
[OK] SQLite: Found at C:\sqlite\sqlite3.exe (version 3.51.0)
[OK] Database: 60 recipes total, 23 active recipes
[OK] Embedding Service: Started successfully, generating 384-dim vectors
[OK] Main API: Started successfully on port 8000
[OK] RAG Compose Endpoint: Working, returning recipes with source 'rag'
[OK] Embedding Cache: 23 recipes cached in recipe_embeddings table
[OK] Automated Tests: 19/19 passed
[OK] Evaluation Script: Completed successfully

Testing completed at: 2025-11-04 23:13:27

=== RAG EVALUATION KPIs ===
Average Hit Rate: 36.67%
Average Precision@3: 26.67%
Average Nutrition Compliance: 80.00%
Average Macro Compliance: 100.00%
Average Response Latency: 2.072 seconds
Embeddings Used: 5/5 tests (100%)

=== ISSUES ENCOUNTERED ===
[RESOLVED] SQLite not in PATH - Using full path C:\sqlite\sqlite3.exe
[RESOLVED] Unicode encoding errors in scripts - Fixed by using ASCII characters
[NOTE] Direct Python import of backend.scripts.embed_service fails - Expected, uvicorn handles module loading
